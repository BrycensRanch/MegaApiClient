# Mega accounts for integration tests

Integration tests require a specific layout. It can be generated by following the following steps and updating the `inputs.json` file. 

### Install megacmd and launch the server
```
scoop install megacmd
$env:USERPROFILE\scoop\apps\megacmd\current\MEGAcmdServer.exe
```

### Launch megacmd
```
$env:USERPROFILE\scoop\apps\megacmd\current\MEGAcmdShell.exe
```

### Layout
```
    +-Root
    |   +-SharedFolder                          (Outgoing Share)
    |       |-SharedFile.jpg
    |       +-SharedSubFolder                   (Outgoing Share)
    |           |-SharedFileUpSideDown.jpg
    +-Trash
    +-Inbox
    +-Contacts
      +-SharedRemoteFolder                      (Incoming Share)
        |-SharedRemoteFile.jpg
        +-SharedRemoteSubFolder                 (Incoming Share / Subfolder of SharedRemoteFolder)
          |-SharedRemoteSubFile.jpg
          +-SharedRemoteSubSubFolder
```

### Accounts creation
Two account are required to generate this layout
```
$account="megaapiclient3@yopmail.com"
$accountshare="megaapiclient3-share@yopmail.com"
```

```
signup $account $account --name="megaapiclient"
confirm [LINK] $account $account
```
```
signup $accountshare $accountshare --name="megaapiclient share"
confirm [LINK] $accountshare $accountshare
```

### Layout configuration
```
login $accountshare $accountshare

mkdir SharedRemoteFolder
cd SharedRemoteFolder
put Data\SampleFile.jpg SharedRemoteFile.jpg
mkdir SharedRemoteSubFolder
cd SharedRemoteSubFolder
put Data\SampleFile.jpg SharedRemoteSubFile.jpg
mkdir SharedRemoteSubSubFolder
cd
share -a --with=$account SharedRemoteFolder

logout
```

```
login $account $account

rm "Welcome to MEGA.pdf"
mkdir SharedFolder
cd SharedFolder
put Data\SampleFile.jpg SharedFile.jpg
preview -s SharedFile.jpg Data\SampleFile_preview.jpg
thumbnail -s SharedFile.jpg Data\SampleFile_thumbnail.jpg
mkdir SharedSubFolder
cd SharedSubFolder
put Data\SampleFileUpSideDown.jpg SharedFileUpSideDown.jpg

cd
export -a -f SharedFolder
export -a -f SharedFolder/SharedFile.jpge

showpcr
ipc $accountshare -a

# Commands used to retrieve the required informations 
ls --tree --show-handles -aaa
ls --tree --show-handles -aaa $accountshare:SharedRemoteFolder

# Command used to retrieve the masterkey
masterkey

logout
```

Once the layout is created, the file `inputs.json` can be updated accordingly